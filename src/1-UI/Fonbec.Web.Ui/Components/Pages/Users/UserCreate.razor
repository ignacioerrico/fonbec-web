@attribute [Route(NavRoutes.UserCreate)]
@attribute [Authorize(Policy = nameof(UserCreate))]
@inherits AuthenticationRequiredComponentBase

@using Fonbec.Web.DataAccess.Constants

<PageHeader Title="Alta de usuario" />

@if (!_anyChapters)
{
	<MudAlert Severity="Severity.Error">No hay filiales. Para dar de alta usuarios se requiere <MudLink Href="@NavRoutes.ChapterCreate" Typo="Typo.body2">al menos una filial</MudLink>.</MudAlert>
}

<LoadingIndicator Loading="Loading" />

<MudForm @bind-IsValid="@_formValidationSucceeded" Disabled="!_anyChapters">
	
	@if (FonbecClaim.ChapterId is null)
	{
		<ChapterSelector @bind-SelectedChapterId="_bindModel.UserChapterId"
		                 OnChaptersLoaded="OnChaptersLoaded" />
	}

	<MudTextField T="string" Label="Nombre" @bind-Value="_bindModel.UserFirstName" Immediate="true" AutoFocus="_anyChapters"
	              Required="true" RequiredError="Este es un campo obligatorio."
	              MaxLength="MaxLength.FonbecWebUser.FirstName" />

	<MudTextField T="string" Label="Apellido" @bind-Value="_bindModel.UserLastName" Immediate="true"
	              Required="true" RequiredError="Este es un campo obligatorio."
	              MaxLength="MaxLength.FonbecWebUser.LastName" />

	<MudTextField T="string" Label="Apodo" @bind-Value="_bindModel.UserNickName" Immediate="true"
	              MaxLength="MaxLength.FonbecWebUser.NickName" />
                  
	<RoleSelector @bind-SelectedRole="_bindModel.UserRole" />

	<GenderSelector @bind-SelectedGender="_bindModel.UserGender" />

	<MudTextField T="string" Label="Correo electrónico" @bind-Value="_bindModel.UserEmail" Immediate="true"
	              Required="true" RequiredError="Este es un campo obligatorio."
	              MaxLength="MaxLength.FonbecWebUser.Email" />

    <MudTextField T="string" Label="Teléfono" @bind-Value="_bindModel.UserPhoneNumber" Immediate="true"
                  MaxLength="MaxLength.FonbecWebUser.PhoneNumber" />

	<MudTextField T="string" Label="Información adicional" @bind-Value="_bindModel.UserNotes" Immediate="true"
                  MaxLength="MaxLength.Auditable.Notes" />
</MudForm>

<MudStack Row="true" Class="pt-4">
	<MudButton OnClick="SaveAsync" Disabled="SaveButtonDisabled"
	           Variant="Variant.Filled" Color="Color.Primary">
		Crear
	</MudButton>
	<MudButton Href="@NavRoutes.Users"
	           Variant="Variant.Filled" Color="Color.Default" Class="ms-4">
		Cancelar
	</MudButton>
</MudStack>
    
<LoadingIndicator Loading="_saving" LoadingText="Guardando los datos" />