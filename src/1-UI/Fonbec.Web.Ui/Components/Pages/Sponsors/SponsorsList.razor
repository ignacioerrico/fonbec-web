@attribute [Route(NavRoutes.Sponsors)]
@attribute [Authorize(Policy = nameof(SponsorsList))]
@inherits AuthenticationRequiredComponentBase

@using Fonbec.Web.Logic.Models.Sponsors
@using Fonbec.Web.DataAccess.Constants

<PageHeader Title="Padrinos" />

<LoadingIndicator Loading="Loading"
				  If="!_viewModels.Any()"
				  ThenDisplay="No hay padrinos." />

@if (_viewModels.Any())
{
	<MudDataGrid T="SponsorsListViewModel"
				 Items="_viewModels"
				 Dense="true" Hover="true" Striped="true" Bordered="true"
				 ReadOnly="false"
				 CommittedItemChanges="@(async viewModel => await CommittedItemChangesAsync(viewModel))"
				 EditMode="DataGridEditMode.Form"
				 EditTrigger="DataGridEditTrigger.Manual"
				 QuickFilter="Filter"
				 Filterable="true"
				 FilterMode="DataGridFilterMode.ColumnFilterRow"
				 FilterCaseSensitivity="DataGridFilterCaseSensitivity.CaseInsensitive"
				 SortMode="SortMode.Multiple"
				 Class="mt-4">
		<ToolBarContent>
			<MudTextField T="string" @bind-Value="_searchString"
						  Placeholder="Buscar"
						  Clearable="true" Immediate="true"
						  Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" />
		</ToolBarContent>
		<Columns>
			<PropertyColumn Property="@(vm => _sortByLastName ? vm.SponsorLastName : vm.SponsorFirstName)" Title="Nombre completo">
				<CellTemplate>
					<AuditableItemDisplay Id="@context.Item.SponsorId"
										  ItemName="@SponsorFullName(context.Item)"
										  Email="@context.Item.SponsorEmail"
										  IsActive="@context.Item.IsSponsorActive"
										  AuditableViewModel="@context.Item" />
				</CellTemplate>
				<EditTemplate>
					<MudTextField T="string" @bind-Value="@context.Item.SponsorFirstName" Immediate="true"
								  Required="true" RequiredError="Este es un campo requerido"
								  Label="Nombre" Variant="Variant.Outlined" Margin="Margin.Dense"
								  MaxLength="MaxLength.FonbecWebUser.FirstName" />
					<MudTextField T="string" @bind-Value="@context.Item.SponsorLastName" Immediate="true" Class="mt-4"
								  Required="true" RequiredError="Este es un campo requerido"
								  Label="Apellido" Variant="Variant.Outlined" Margin="Margin.Dense"
								  MaxLength="MaxLength.FonbecWebUser.LastName" />
				</EditTemplate>
			</PropertyColumn>
			<PropertyColumn Property="vm => vm.SponsorNickName" Title="Apodo" Required="false">
				<EditTemplate>
					<MudTextField T="string" @bind-Value="context.Item.SponsorNickName" Immediate="true"
								  Label="Apodo" Variant="Variant.Outlined" Margin="Margin.Dense"
								  MaxLength="MaxLength.FonbecWebUser.NickName" />
				</EditTemplate>
			</PropertyColumn>
			<PropertyColumn Property="vm => vm.SponsorEmail" Title="Correo electrónico">
				<CellTemplate>
					<MudLink Href="@($"mailto:{context.Item.SponsorEmail}")">
						@context.Item.SponsorEmail
					</MudLink>
				</CellTemplate>
				<EditTemplate>
					<MudTextField T="string" @bind-Value="context.Item.SponsorEmail" Immediate="true"
								  Label="Email" Variant="Variant.Outlined" Margin="Margin.Dense"
								  MaxLength="MaxLength.FonbecWebUser.Email" />
				</EditTemplate>
			</PropertyColumn>
			<PropertyColumn Property="vm => vm.SponsorPhoneNumber" Title="Teléfono" Required="false">
				<EditTemplate>
					<MudTextField T="string" @bind-Value="context.Item.SponsorPhoneNumber" Immediate="true"
								  Label="Teléfono" Variant="Variant.Outlined" Margin="Margin.Dense"
								  MaxLength="MaxLength.FonbecWebUser.PhoneNumber" />
				</EditTemplate>
			</PropertyColumn>
		</Columns>
		<PagerContent>
			<MudDataGridPager T="SponsorsListViewModel" RowsPerPageString="Filas por página:" InfoFormat="{first_item}-{last_item} of {all_items}" />
		</PagerContent>
	</MudDataGrid>
}
